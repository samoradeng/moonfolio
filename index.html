<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Crypto Moon üåï</title>
    <link href="https://cdn.jsdelivr.net/npm/jquery-ui-dist/jquery-ui.min.css" rel="stylesheet" />
    <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/jquery-ui-dist/jquery-ui.min.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=DM+Sans:ital,opsz,wght@0,9..40,100..1000;1,9..40,100..1000&family=Inter:wght@100..900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="styles.css">
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore-compat.js"></script>

    <script src="https://js.stripe.com/v3/"></script>
    
    <script type="text/javascript" src="https://cdn.emailjs.com/dist/email.min.js"></script>
    <script type="text/javascript">
        (function(){
            emailjs.init("W7vuD5ONPc1mcb_Xa"); // Replace with your actual EmailJS public key
        })();
    </script>
    
    <!-- Web3 and Wallet Integration Scripts -->
    <script src="https://unpkg.com/@solana/web3.js@latest/lib/index.iife.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.umd.min.js"></script>
</head>
<header>
    <div class="header-container">
        <div class="header-logo">
            <img src="/images/moonfolio-logo-desktop.svg" alt="Moonfolio Desktop Logo" class="desktop-logo">
            <img src="/images/moonfolio-logo-mobile.svg" alt="Moonfolio Mobile Logo" class="mobile-logo">
        </div>
        <nav class="header-nav">
            <button id="connectWalletButton" class="auth-button wallet-button">üîó Connect Wallet</button>
            <button id="exchangeIntegrationButton" class="auth-button exchange-button">üìä Connect Exchange</button>
            <button id="alertsButton" class="auth-button alerts-button">üîî Alerts</button>
            <button id="signInModalButton" class="auth-button">Sign in</button>
            <button id="signUpModalButton" class="auth-button sign-up">Sign up</button>
            <div id="userMenuContainer" class="user-menu-container">
                <button id="userIcon" class="user-icon">
                    <img src="/images/moonfolio-user-icon.svg" alt="User Icon">
                </button>                
                <div id="userDropdown" class="user-dropdown">
                    <button id="feedbackButton" class="auth-button">Feedback</button> <!-- Moved inside -->
                    <button id="checkout-button" class="auth-button" style="display:none;">Get Premium</button>
                    <button id="signOutButton" class="auth-button">Sign Out</button>
                </div>
            </div>
        </nav>
    </div>
</header>




<!-- Feedback Modal -->
<div id="feedbackModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <span id="closeFeedbackModal" class="close-button">&times;</span>
            <h2>Feedback</h2>
        </div>
        <div class="modal-body">
            <form id="feedbackForm">
                <div class="form-group">
                    <label for="feedbackEmail">Your email</label>
                    <input type="email" id="feedbackEmail" name="user_email" placeholder="Your email (optional)">
                </div>
                <div class="form-group">
                    <label for="feedbackMessage">Feedback</label>
                    <textarea id="feedbackMessage" name="message" rows="4" placeholder="Your feedback" required></textarea>
                </div>
                <button type="submit" id="submitFeedbackButton">Submit Feedback</button>
            </form>
        </div>
    </div>
</div>

<!-- Toast Container -->
<div id="toastContainer" class="toast-container"></div>

<!-- Wallet Connection Modal -->
<div id="walletModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <span id="closeWalletModal" class="close-button">&times;</span>
            <h2>Connect Your Wallet</h2>
        </div>
        <div class="modal-body">
            <div class="wallet-options">
                <button id="connectMetamask" class="wallet-option-btn">
                    <img src="https://upload.wikimedia.org/wikipedia/commons/3/36/MetaMask_Fox.svg" alt="MetaMask" class="wallet-icon">
                    <span>MetaMask</span>
                </button>
                <button id="connectPhantom" class="wallet-option-btn">
                    <img src="https://phantom.app/img/phantom-icon-purple.png" alt="Phantom" class="wallet-icon">
                    <span>Phantom</span>
                </button>
                <button id="connectWalletConnect" class="wallet-option-btn">
                    <img src="https://walletconnect.com/walletconnect-logo.svg" alt="WalletConnect" class="wallet-icon">
                    <span>WalletConnect</span>
                </button>
            </div>
            <div id="walletStatus" class="wallet-status"></div>
            <div id="connectedWallets" class="connected-wallets"></div>
        </div>
    </div>
</div>

<!-- Exchange Integration Modal -->
<div id="exchangeModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <span id="closeExchangeModal" class="close-button">&times;</span>
            <h2>Connect Exchange</h2>
        </div>
        <div class="modal-body">
            <div class="exchange-options">
                <button id="connectCoinbase" class="exchange-option-btn">
                    <img src="https://logos-world.net/wp-content/uploads/2021/02/Coinbase-Symbol.png" alt="Coinbase" class="exchange-icon">
                    <span>Coinbase</span>
                </button>
                <button id="connectBinance" class="exchange-option-btn">
                    <img src="https://cryptologos.cc/logos/binance-coin-bnb-logo.png" alt="Binance" class="exchange-icon">
                    <span>Binance</span>
                </button>
                <button id="connectKraken" class="exchange-option-btn">
                    <img src="https://cryptologos.cc/logos/kraken-exchange-kraken-logo.png" alt="Kraken" class="exchange-icon">
                    <span>Kraken</span>
                </button>
            </div>
            <div id="exchangeApiForm" class="exchange-api-form" style="display:none;">
                <h3 id="selectedExchangeName"></h3>
                <div class="form-group">
                    <label for="apiKey">API Key</label>
                    <input type="password" id="apiKey" placeholder="Your API Key">
                </div>
                <div class="form-group">
                    <label for="apiSecret">API Secret</label>
                    <input type="password" id="apiSecret" placeholder="Your API Secret">
                </div>
                <div class="form-group">
                    <label for="apiPassphrase">Passphrase (if required)</label>
                    <input type="password" id="apiPassphrase" placeholder="Passphrase (optional)">
                </div>
                <div class="api-permissions-note">
                    <p><strong>‚ö†Ô∏è Important:</strong> Only use READ-ONLY API keys. Never share keys with trading permissions.</p>
                </div>
                <button id="saveExchangeConnection" class="auth-button">Connect Exchange</button>
            </div>
            <div id="connectedExchanges" class="connected-exchanges"></div>
        </div>
    </div>
</div>

<!-- Alerts Management Modal -->
<div id="alertsModal" class="modal">
    <div class="modal-content alerts-modal">
        <div class="modal-header">
            <span id="closeAlertsModal" class="close-button">&times;</span>
            <h2>Alert Management</h2>
        </div>
        <div class="modal-body">
            <div class="alerts-tabs">
                <button id="priceAlertsTab" class="alert-tab active">Price Alerts</button>
                <button id="portfolioAlertsTab" class="alert-tab">Portfolio Alerts</button>
                <button id="marketAlertsTab" class="alert-tab">Market Alerts</button>
            </div>
            
            <!-- Price Alerts Tab -->
            <div id="priceAlertsContent" class="alert-content active">
                <div class="create-alert-form">
                    <h3>Create Price Alert</h3>
                    <div class="form-group">
                        <label for="alertCoin">Select Coin</label>
                        <input type="text" id="alertCoin" placeholder="Search for a coin...">
                    </div>
                    <div class="form-group">
                        <label for="alertType">Alert Type</label>
                        <select id="alertType">
                            <option value="price_above">Price Above</option>
                            <option value="price_below">Price Below</option>
                            <option value="price_change">Price Change %</option>
                            <option value="volume_spike">Volume Spike</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="alertValue">Alert Value</label>
                        <input type="number" id="alertValue" placeholder="e.g., 50000 or 10%">
                    </div>
                    <div class="form-group">
                        <label for="alertFrequency">Frequency</label>
                        <select id="alertFrequency">
                            <option value="once">Once</option>
                            <option value="daily">Daily</option>
                            <option value="always">Every time</option>
                        </select>
                    </div>
                    <button id="createPriceAlert" class="auth-button">Create Alert</button>
                </div>
                <div id="priceAlertsList" class="alerts-list"></div>
            </div>

            <!-- Portfolio Alerts Tab -->
            <div id="portfolioAlertsContent" class="alert-content">
                <div class="create-alert-form">
                    <h3>Portfolio Performance Alerts</h3>
                    <div class="form-group">
                        <label for="portfolioAlertType">Alert Type</label>
                        <select id="portfolioAlertType">
                            <option value="total_gain">Total Gain/Loss %</option>
                            <option value="daily_change">Daily Change %</option>
                            <option value="rebalance_needed">Rebalancing Needed</option>
                            <option value="goal_reached">Investment Goal Reached</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="portfolioAlertValue">Threshold Value</label>
                        <input type="number" id="portfolioAlertValue" placeholder="e.g., 20% or $10000">
                    </div>
                    <button id="createPortfolioAlert" class="auth-button">Create Alert</button>
                </div>
                <div id="portfolioAlertsList" class="alerts-list"></div>
            </div>

            <!-- Market Alerts Tab -->
            <div id="marketAlertsContent" class="alert-content">
                <div class="create-alert-form">
                    <h3>Market Condition Alerts</h3>
                    <div class="form-group">
                        <label for="marketAlertType">Alert Type</label>
                        <select id="marketAlertType">
                            <option value="fear_greed">Fear & Greed Index</option>
                            <option value="market_cap">Total Market Cap</option>
                            <option value="btc_dominance">Bitcoin Dominance</option>
                            <option value="funding_rates">Funding Rates</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="marketAlertValue">Threshold Value</label>
                        <input type="number" id="marketAlertValue" placeholder="e.g., 25 (Fear & Greed)">
                    </div>
                    <button id="createMarketAlert" class="auth-button">Create Alert</button>
                </div>
                <div id="marketAlertsList" class="alerts-list"></div>
            </div>
        </div>
    </div>
</div>

<body>
    <!-- Sign In/Sign Up Modal -->
    <div id="authModal" class="modal">
        <div class="modal-content auth-modal">
            <div class="modal-header">
                <h2 id="modalTitle">Sign In</h2>
                <span class="close-button">&times;</span>
            </div>
            <div class="modal-body">
                <div id="authContainer">
                    <div id="signInForm">
                        <input type="email" id="email" placeholder="Email" required>
                        <div class="password-container">
                            <input type="password" id="password" placeholder="Password" required>
                            <button type="button" id="togglePassword">Show</button>
                        </div>
                        <div id="errorMessage" class="error-message"></div>
                        <button id="signInButton">Sign In</button>
                        <p class="toggle-form">Don't have an account? <a href="#" id="switchToSignUp">Sign Up</a></p>
                        <p class="toggle-form"><a href="#" id="forgotPasswordLink">Forgot Password?</a></p>
                        <div id="loadingIndicator" class="loading-indicator" style="display:none;">Loading...</div>
                    </div>
                    <div id="signUpForm" style="display:none;">
                        <input type="email" id="signUpEmail" placeholder="Email" required>
                        <div class="password-container">
                            <input type="password" id="signUpPassword" placeholder="Password" required>
                            <button type="button" id="toggleSignUpPassword">Show</button>
                        </div>
                        <div id="signUpErrorMessage" class="error-message"></div>
                        <button id="signUpButton">Sign Up</button>
                        <p class="toggle-form">Already have an account? <a href="#" id="switchToSignIn">Sign In</a></p>
                        <div id="signUpLoadingIndicator" class="loading-indicator" style="display:none;">Loading...</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id="userContainer" style="display:none;">
        <p>Welcome, <span id="userEmail"></span></p>
        <button id="checkout-button" style="display: none;">Get Premium</button>
    </div>

    <div id="emailVerificationModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Email Verification</h2>
                <span id="closeEmailVerificationModal" class="close-button">&times;</span>
            </div>
            <div class="modal-body">
                <p>We have sent a verification email to you. Please verify your email then refresh before continuing.</p>
                <button id="resendVerificationButton">Resend Verification Email</button>
                <div id="resendVerificationMessage" class="info-message" style="display:none;"></div>
            </div>
        </div>
    </div>

    <div class="dashboardTotals">
        <div class="total-investment">
            <p id="dashboardTotals-title">Current Balance:</p>
            <span id="totalInvestment">0</span>
        </div>
        <div class="profit-loss">
            <p id="dashboardTotals-title">Profit / Loss:</p>
            <span id="totalProfit">0</span> <span id="totalPercentage">0%</span>
        </div>
    </div>

    <div class="container">
        <div class="assets-header">
            <h2>Your Assets</h2>
            <button id="addCoinButton" class="add-coin-button">+ Add Coin</button>
        </div>
        <div id="timeframeDisplay"></div>
        <div class="table-container">
            <table>
                <thead>
                    <tr>
                        <th>#</th> <!-- New column header for coin numbers -->
                        <th>Coin</th>
                        <th>Investment Date</th>
                        <th>Current Price</th>
                        <th>Investment Amount</th>
                        <th>Base Case ROI</th>
                        <th>Moon Case ROI</th>
                        <th>Current ROI</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody id="portfolioTable"></tbody>
            </table>
        </div>
    </div>

    <!-- Add Coin Modal -->
    <div id="addCoinModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="AddTransactionHeaderText">Add Coin</h2>
                <span id="closeAddCoinModal" class="close-button">&times;</span>
            </div>
            <div class="modal-body">
                <form id="cryptoForm">
                    <div class="form-group">
                        <label for="coinSearch">Coin Name</label>
                        <input type="text" id="coinSearch" placeholder="Start typing to search..." required>
                    </div>
                    <div class="form-group">
                        <label for="amountInvested">Amount Invested (usd)</label>
                        <input type="number" id="amountInvested" placeholder="e.g., 1000" required>
                    </div>
                    <div class="form-group">
                        <label for="investmentDate">Investment Date</label>
                        <input type="date" id="investmentDate" required>
                    </div>
                    <div class="form-group">
                        <label for="currentMarketCap">Current Market Cap</label>
                        <input type="text" id="currentMarketCap" readonly>
                    </div>
                    <div class="form-group">
                        <label for="baseCaseMC">Base Case</label>
                        <select id="baseCaseMC" required>
                            <option value="" disabled selected>Select multiplier</option>
                        </select>
                        <input type="number" id="baseCaseMCManual" placeholder="Market Cap" disabled>
                        <input type="number" id="baseCaseMultiplierManual" placeholder="Multiplier (x)" disabled>
                    </div>
                    <div class="form-group">
                        <label for="moonCaseMC">Moon Case</label>
                        <select id="moonCaseMC" required>
                            <option value="" disabled selected>Select multiplier</option>
                        </select>
                        <input type="number" id="moonCaseMCManual" placeholder="Market Cap" disabled>
                        <input type="number" id="moonCaseMultiplierManual" placeholder="Multiplier (x)" disabled>
                    </div>
                    <button id="addTransactionButton" type="submit">Add Coin</button>
                </form>
            </div>
        </div>
    </div>

    <!-- Confirmation Modal -->
    <div id="confirmationModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Remove coin from portfolio</h2>
                <span id="closeConfirmationModal" class="close-button">&times;</span>
            </div>
            <div class="modal-body">
                <p>Do you really want to remove this coin? All associated transactions will also be removed. This cannot be undone.</p>
                <div class="modal-actions">
                    <button id="cancelButton" class="auth-button">Cancel</button>
                    <button id="confirmButton" class="auth-button sign-up">Remove</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Forgot Password Modal -->
    <div id="forgotPasswordModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Forgot Password</h2>
                <span id="closeForgotPasswordModal" class="close-button">&times;</span>
            </div>
            <div class="modal-body">
                <form id="resetPasswordForm">
                    <div class="form-group">
                        <label for="resetPasswordEmail">Email</label>
                        <input type="email" id="resetPasswordEmail" placeholder="Enter your email" required>
                    </div>
                    <button type="button" id="forgotPasswordButton">Reset Password</button>
                    <div id="resetPasswordMessage" class="info-message" style="display:none;"></div>
                </form>
            </div>
        </div>
    </div>

    <!-- Upgrade Modal -->
    <div id="upgradeModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2> </h2>
                <span id="closeUpgradeModal" class="close-button">&times;</span>
            </div>
            <div class="modal-body">
                
                <p>Outperform with insight</p>
                <ul>
                  <!--  <li>Add multiple portfolios</li> -->
                    <li>Add more than 3 coins. Also get unlimited access to all future premium features.</li>
                   
                    <br>
                    <li>$9.99/month ¬∑ Cancel anytime</li>
                </ul>
                <button id="upgradeButton" class="auth-button sign-up">Get Premium</button>
            </div>
        </div>
    </div>

    <script>
        const stripe = Stripe('pk_test_51LmKU1CF77PCDzZfQKJuLw4d0ZkJ44NUAUZysAXLYtLLPXgN6wky9WFUyZdtYTGiTKUhNaLWYgQHhaLHiCmdSdHy00KQYbsMC1');
    </script>

    <script src="script.js"></script>
</body>
</html>
